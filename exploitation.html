<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, shrink-to-fit=no">
  <link href="assets/images/favicon.png" rel="icon" />
  <title>Documentation | Projet UF</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- Stylesheet
       ============================== -->
  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="assets/vendor/bootstrap/css/bootstrap.min.css" />

  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" />
  <!-- Font Awesome Icon -->
  <link rel="stylesheet" type="text/css" href="assets/vendor/font-awesome/css/all.min.css" />
  <!-- Magnific Popup -->
  <link rel="stylesheet" type="text/css" href="assets/vendor/magnific-popup/magnific-popup.min.css" />
  <!-- Highlight Syntax -->
  <link rel="stylesheet" type="text/css" href="assets/vendor/highlight.js/styles/github.css" />
  <!-- Custom Stylesheet -->
  <link rel="stylesheet" type="text/css" href="assets/css/stylesheet.css" />
</head>

<body class="box" data-spy="scroll" data-target=".idocs-navigation" data-offset="125" data-target="#toc">
  <!-- Preloader -->
  <div class="preloader">
    <div class="lds-ellipsis">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <!-- Preloader End -->
  <!-- Document Wrapper
   =============================== -->
  <div id="main-wrapper">
    <!-- Header
       ============================ -->
    <header id="header" class="sticky-top">
      <!-- Navbar -->
      <nav class="primary-menu navbar navbar-expand-lg navbar-dropdown-dark">
        <div class="container-fluid">
          <!-- Sidebar Toggler -->
          <button id="sidebarCollapse" class="navbar-toggler d-block d-md-none" type="button"><span></span><span
              class="w-75"></span><span class="w-50"></span></button>
          <!-- Logo -->
          <a class="logo ml-md-3" title="iDocs Template"> <img
              src="assets/images/logo-light.png" alt="iDocs Template" /> </a>
          <span class="text-2 ml-2">v1.0</span>
          <!-- Logo End -->
          <!-- Navbar Toggler -->
          <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse"
            data-target="#header-nav"><span></span><span></span><span></span></button>
          <div id="header-nav" class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
              <li><a href="index.html">Documentation d'architecture</a></li>
              <li><a href="exploitation.html" class="active">Documentation d'exploitation</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Navbar End -->
    </header>
    <!-- Header End -->
    <!-- Content
       ============================ -->
    <div id="content" role="main">
      <!-- Sidebar Navigation
           ============================ -->
      <div class="idocs-navigation bg-dark">
        <ul class="nav flex-column ">
          <li class="nav-item">
            <a class="nav-link active" href="#idocs_1">
              1. Outils et services liés à pfSense</a>
            <ul class="nav flex-column">
              <li class="nav-item"><a class="nav-link" href="#idocs_1_1">1.1 DHCP</a></li>
              <li class="nav-item"><a class="nav-link" href="#idocs_1_2">1.2 Accès à l'interface graphique de configuration</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#idocs_2">2. Accès au site web de l'entreprise</a>
            <ul class="nav flex-column">
              <li class="nav-item"><a class="nav-link" href="#idocs_2_1">2.1 Depuis le réseau interne (LAN)</a></li>
              <li class="nav-item"><a class="nav-link" href="#idocs_2_2">2.2 Depuis l'extérieur (WAN)</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#idocs_3">3. Gestion des fichiers du serveur web</a>
            <ul class="nav flex-column">
              <li class="nav-item"><a class="nav-link" href="#idocs_3_1">3.1 Sauvegarde des fichiers</a></li>
              <li class="nav-item"><a class="nav-link" href="#idocs_3_2">3.2 Restauration des fichiers</a></li>
              <li class="nav-item"><a class="nav-link" href="#idocs_3_3">3.3 Suppression des anciens fichiers de sauvegarde</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!-- Docs Content
           ============================ -->
      <div class="idocs-content bg-dark">
        <div class="container">
          <section id="before">
            <h1>UF Infrastructure & Système d’information</h1>
            <h2>ARCHITECTURE CLIENT-SERVEUR</h2>
            <p class="lead">Documentation d'exploitation</p>
            <hr>
            <div class="row">
              <div class="col-sm-6 col-lg-4">
                <ul class="list-unstyled">
                  <li><strong>Version:</strong> 1.0</li>
                  <li><strong>Auteurs:</strong> <a href="https://github.com/evzs" target="_blank">CHIBANE Eva</a>, <a
                      href="https://github.com/RathGate" target="_blank">CORBEL Marianne</a></li>

                </ul>
              </div>
              <div class="col-sm-6 col-lg-4">
                <ul class="list-unstyled">
                  <li><strong class="font-weight-700">Formation :</strong> YNOV Informatique</li>
                  <li><strong class="font-weight-700">Promotion :</strong> B1 Info AIX YNOV Campus 2022-2023
                  </li>
                </ul>
              </div>
              <div class="col-sm-6 col-lg-4">
                <ul class="list-unstyled">
                  <li><strong class="font-weight-700">Créée :</strong> 8 mai 2023</li>
                  <li><strong class="font-weight-700">Mise à jour :</strong> 8 mai 2023</li>
                </ul>
              </div>
            </div>
          </section>
          <!-- Intro
   ============================ -->
          <br><br>
          <section id="idocs_1">
            <h1>1. Outils et services liés à pfSense</h1>
              <p class="text-4">
                La très grande majorité des outils et services mis en place dans l’infrastructure, notamment ceux inclus dans le serveur
                pfSense, sont automatiques et ne nécessitent pas de configuration autre que la configuration de base mentionnée dans la
                documentation d’architecture technique.
              </p>
          </section>
          <br><br>
          <!-- <hr class="divider"> -->
          <!-- 1.1 But et portée de la documentation
                   ============================ -->
          <section id="idocs_1_1">
            <h2>1.1 DHCP</h2>
            <p class="text-4">Pour se voir attribuer une IP par DHCP (c'est-à-dire pour ne pas avoir à entrer manuellement les informations liées au réseau), la machine hôte doit s'assurer d'être dans un sous-réseau ayant le serveur DHCP actif.</p>
            <p class="text-4">Cette information est vérifiable dans les paramètres DCHP du sous-réseau en question, sur le configurateur web du pare-feu pfSense.</p>
            <p class="text-4">Si le sous-réseau a un serveur DHCP actif et une plage d'IP valide, l'utilisateur doit laisser les paramètres réseau de la machine en "automatique".</p>
            <p><a class="popup-img" href="assets/images/topologie.png"><img src="assets/images/dhcp.png" class="img-fluid img-thumbnail" alt="image"></a></p>
            <p class="text-4">Si l'attribution par DHCP ne semble pas marcher, il est conseillé de vérifier que le réseau n'a pas atteint sa limite d'appareils connectés au même moment.</p>

          </section>
          <br><br>
          <!-- 1.2 Importance de la documentation dans le cadre d’une petite entreprise
                   ============================ -->
          <section id="idocs_1_2">
            <h2>1.2 Accès à l'interface graphique de configuration</h2>
            <p class="text-4">Par défaut, le configurateur graphique est accessible sur le port HTTPS de l'adresse IP pfSense du réseau dans lequel se situe l'hôte.</p>
            <p class="text-4">Si la configuration de la solution a été faite au complet, il est possible de s'y connecter depuis le WAN et depuis le LAN. Tant que la règle n'est pas désactivée, le configurateur web sera toujours accessible depuis le LAN.</p>
                        <p class="text-4">S'il ne semble pas possible de s'y connecter, l'administrateur peut tenter de désactiver les règles du pare-feu par le shell du pfSense avec la commande `pfctl -d`. Elles seront rétablies au prochain redémarrage du système.</p>

          </section>
          <hr class="divider">
          <!-- 2. Infrastructure générale
                   ============================ -->
          <section id="idocs_2">
            <h1>2. Accès au site web de l'entreprise</h1>
            <p class="lead mb-5">Il est nécessaire que le serveur web (10.10.0.10) soit connecté au pare-feu, avec le serveur Apache en fonctionnement, pour que les utilisateurs puissent avoir accès au site web.</p>
            <p><a class="popup-img" href="assets/images/portforward.png"><img src="assets/images/portforward.png" class="img-fluid img-thumbnail" alt="image"></a></p>
          </section>
          <br><br>
          <!-- 2.1 Topologie du réseau
                   ============================ -->
          <section id="idocs_2_1">
            <h2>2.1 Depuis le réseau interne (LAN)</h2>

            <p class="text-4">Le site web est accessible depuis l'intérieur du réseau interne par l'adresse http://10.10.0.1 (port HTTP de l'adresse IP LAN du pfSense).</p>
          </section>
          <br><br>
          <!-- 2.2 Définition succincte des éléments des réseaux
                   ============================ -->
          <section id="idocs_2_2">
            <h2>2.1 Depuis l'extérieur (WAN)</h2>
            
            <p class="text-4">Le site web est accessible depuis l'intérieur du réseau externe par le port HTTP de l'adresse IP WAN du pfSense (par exemple http://192.168.1.115). Il est normalement accessible par toutes les machines se trouvant également sur le WAN.</p>
          </section>
          <hr class="divider">
          <!-- 3. Liste des composants applicatifs
                   ============================ -->
          <section id="idocs_3">
            <h1>3. Gestion des fichiers du serveur web</h1>
            <p class="alert alert-info">Le super-utilisateur (sudo) doit être utilisé pour lancer les scripts mentionnés ci-après. Il est donc nécessaire d'en avoir les accès.
            </p>
            <p class="text-4">Le serveur de backup (10.10.0.2) est le serveur responsable des sauvegardes et de la restauration des fichiers du serveur web (10.10.0.10). Il est conseillé de réaliser toutes les manoeuvres directement sur celui-ci.</p>
            <p class="text-4">Cependant, conformément au cahier des charges, le serveur de backup est accessible par tous les appareils se situant dans son réseau (réseau interne LAN, 10.10.0.1/29). Ceux-ci, par l'intermédiaire d'un démon SSH (cité dans les logiciels de base des clients), peuvent, à condition d'en avoir les accès, manipuler le serveur de backup et lancer les scripts à distance.</p>
          </section>
          <br><br>
          <!-- 3.1 pfSense (WAN, LAN, DMZ)
                   ============================ -->
          <section id="idocs_3_1">

            <h2>3.1 Sauvegarde des fichiers</h2>
            <p class="text-4">Le fichier de sauvegarde de fichier se trouve au chemin `/home/backup-server/web_backups/scripts/backup.sh`. A l'exécution, il récupère les fichiers du serveur web en s'y connectant, et les compresse en une archive stockée dans `/home/backup-server/web_backups/backups/`.</p>
            <p class="text-4">La nomenclature de ces fichiers est spécifique est normée: elle contient la date au format YY-MM-DD suivie de l'heure au format HH-MM-SS.</p>
            <p><a class="popup-img" href="assets/images/archives.png"><img src="assets/images/archives.png" class="img-fluid img-thumbnail" alt="image"></a></p>
            <br>
            <h4>3.1.1 Sauvegarde manuelle</h4>
            <p class="text-4">Le fichier de sauvegarde `backup.sh` peut être appelé à tout moment pour réaliser une sauvegarde manuelle des fichiers du serveur, à l'aide de la commande `sudo path/to/file/backup.sh`.</p>
            <p><a class="popup-img" href="assets/images/success.png"><img src="assets/images/success.png" class="img-fluid img-thumbnail" alt="image"></a></p>
            <p class="text-4">Si le processus semble prendre du temps, il convient de l'arrêter avec Ctrl+C. S'il s'agit d'une erreur liée au réseau, elle s'affichera directement.</p>
      <br>
            <h4>3.1.2 Sauvegarde automatique</h4>
            <p class="text-4">Le serveur de backup gère les sauvegardes automatiques, tous les jours à une heure donnée, grâce à l'utilitaire de planificateur de tâches crontab.</p>
            <p class="text-4">Il est possible de modifier l'heure de sauvegarde en éditant l'avant-dernière ligne du fichier de configuration crontab, accessible par `sudo crontab -e`.</p>

            <p class="text-4">Ici par exemple, l'heure de sauvegarde automatique est à 18h30.</p>
            <p class="alert alert-info">Il est important de noter que crontab ne signale pour l'instant pas un plantage du processus.</p>
          </section>
          <br><br>
          <!-- 3.2 Serveur Web (DMZ)
                   ============================ -->
          <section id="idocs_3_2">

            <h2>3.2 Restauration des fichiers</h2>
            <p class="text-4">Le fichier de récupération de fichier se trouve au chemin `/home/backup-server/web_backups/scripts/restore.sh`. A
            l'exécution, il propose à l'utilisateur de choisir parmi les fichiers stockés dans `/home/backup-server/web_backups/backups/`, envoie ladite archive au serveur web et lui demande de lancer un script supposé extraire et déplacer les fichiers dans le dossier du site web.</p>
            <p class="text-4">Il est possible de lancer ce script en utilisant la commande `sudo ./restore.sh`.</p>
            <p><a class="popup-img" href="assets/images/restore1.png"><img src="assets/images/restore1.png"
                  class="img-fluid img-thumbnail" alt="image"></a></p>
                  <br>
            <p class="alert alert-info">A noter que le mot de passe super-utilisateur du serveur web est demandé lors de l'exécution de la restauration. Il est impératif de connaître les identifiants des deux serveurs pour pouvoir remplacer les données sur le serveur web.
            </p>

          </section>
          <br><br>
          <!-- 3.3 Serveur Backup (LAN)
                   ============================ -->
          <section id="idocs_3_3">
            <h2>3.1 Suppression des anciens fichiers de sauvegarde</h2>
            <p class="text-4">Afin d'éviter une surcharge du disque dur du serveur, le script `/home/backup-server/web_backups/scripts/remove.sh` permet la suppression des fichiers vieux de plus de trente jours.</p>
            <p class="text-4">Il est exécuté quotidiennement, en même temps que la sauvegarde du serveur web. De la même manière, l'heure de son exécution peut être modifiée en altérant le fichier de configuration de crontab.</p>
            <p><a class="popup-img" href="assets/images/editcron2.png"><img src="assets/images/editcron2.png"
                  class="img-fluid img-thumbnail" alt="image"></a></p>
            <p class="text-4">Il est possible de réduire ou d'augmenter le nombre de jours avant suppression en changeant le remplaçant le `30` situé à la troisième ligne du fichier du script.</p>
          <p><a class="popup-img" href="assets/images/thirtydays.png"><img src="assets/images/thirtydays.png"
                class="img-fluid img-thumbnail" alt="image"></a></p>
          </section>
          <!-- 3.4 Client Windows (LAN)
                   ============================ -->
          
        </div>
      </div>
    </div>
    <!-- Content end -->
    <!-- Footer
       ============================ -->
    <footer id="footer" class="section bg-dark footer-text-light">
      <div class="container">
        <ul class="social-icons social-icons-lg social-icons-muted justify-content-center mb-3">
          <li><a data-toggle="tooltip" href="https://github.com/evzs/CORBEL_CHIBANE_PROJET_UF_INFRA" target="_blank" title="" data-original-title="GitHub"><i
                class="fab fa-github"></i></a></li>
        </ul>
        <p class="text-center">Copyright &copy; 2020 <a
            href="http://www.harnishdesign.net/idocs-one-page-documentation-html-template/">iDocs</a>. All Rights
          Reserved.</p>
        <p class="text-2 text-center mb-0">Design &amp; Develop by <a class="btn-link" target="_blank"
            href="http://www.harnishdesign.net/">HarnishDesign</a>.</p>
      </div>
    </footer>
    <!-- Footer end -->
  </div>
  <!-- Document Wrapper end -->
  <!-- Back To Top -->
  <a id="back-to-top" data-toggle="tooltip" title="Back to Top" href="javascript:void(0)"><i
      class="fa fa-chevron-up"></i></a>
  <!-- JavaScript
   ============================ -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
  <!-- Highlight JS -->
  <script src="assets/vendor/highlight.js/highlight.min.js"></script>
  <!-- Easing -->
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <!-- Magnific Popup -->
  <script src="assets/vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
  <!-- Custom Script -->
  <script src="assets/js/theme.js"></script>
</body>

</html>